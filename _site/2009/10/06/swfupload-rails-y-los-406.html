<!DOCTYPE HTML>
<html>
<head>
  <title>Fernando Espinosa | Freelance ruby and iOS developer. SWFUpload, Rails y los 406</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/ferdev.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/animations.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/glyphs.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/solarizeddark.css" />
  <meta name="description" content="I'm a freelance ruby and iOS developer based in Madrid, Spain. I love ruby and crafting beautiful apps with it." />
  <meta name="keywords" content="ruby, rails, ruby on rails, iOS, rubymotion, developer, freelance, freelance developer, freelance ruby, freelance rails, freelance ruby on rails, freelance iOS, freelance rubymotion, front-end, back-end, css, css3, javascript, jquery" />
  <link rel="canonical" href="http://www.ferdev.com" />
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml" />
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml" />
</head>
<body id="home">
  <header>
  <hgroup>

    <div class="photo">
      <div class="white_border">
      </div>
      <img src="/images/ferdev@2x.png" alt="Fernando Espinosa" width="65" height="65" />
    </div>

    <div class="name">
      <h3>fernando espinosa</h3>
      <h3>freelance ruby developer</h3>
    </div>

  </hgroup>
  <nav>
	<ul id="menu">
		<li><a href="/" title="home">home</a></li>
		<li><a href="/portfolio.html" title="portfolio">portfolio</a></li>
		<li><a href="/about-me.html" title="about me">about me</a></li>
		<li><a href="/hire-me.html" title="hiring me">hire me</a></li>
		<li><a href="/contact-me.html" title="contact">contact</a></li>
    <li class="top"><a href="#home" title="home">up</a></li>
	</ul>
</nav>

</header>

<section class="introduction">
  <div class="balloon_tail_small"></div>
  <div class="balloon_tail_medium"></div>
  <div class="balloon">
    <p class="hi"><strong>Hi!</strong></p>
    <p>
      I'm <strong>Fernando Espinosa</strong>, a <strong>developer</strong> based in Madrid, Spain.<br/>
      I <span>&#x2665;</span> <strong>ruby</strong> and crafting <strong>beautiful</strong> apps with it.
    </p>
  </div>
</section>


  <script type="text/javascript">
  var idcomments_acct = '9485e3d1ca4f30d30b14d9171a8b93b7';
  var idcomments_post_id;
  var idcomments_post_url;
</script>

<article>
  <h1>SWFUpload, Rails y los 406</h1>
   <a rel="tag" href="/tag/rails/">rails</a>&nbsp; <a rel="tag" href="/tag/ruby/">ruby</a>&nbsp; <a rel="tag" href="/tag/flash/">flash</a>&nbsp; <a rel="tag" href="/tag/swfupload/">swfupload</a>&nbsp;

  <p>En una aplicación que tenía funcionando en Snow Leopard con SWFUpload para subir imágenes al servidor, y RoR en el lado del servidor, me estaba dando problemas al realizar los uploads desde Internet Explorer 8. En concreto, el servidor me devolvía un error 406 tras haber guardado la imagen y justo antes de realizar la respuesta al navegador(en formato json). El error 406 se produce cuando desde el servidor se está respondiendo a una solicitud con un tipo MIME que no está soportado dentro de la cabecera ACCEPT que envió el navegador. El servidor no sabe qué hacer con la solicitud, y lanza ese error.</p>

<p>Bien, pues se produce en concreto con IE8 en Windows XP porque SWFUpload envía como único tipo MIME en su cabecera ACCEPT el tipo &#8220;text/*&#8221;. Imagino que es un problema con el plugin de Flash de Windows (Flash 10 estaba usando), y que si lo pruebo con otro navegador en Windows sucederá lo mismo, no lo he probado.</p>

<p>Para solucionarlo, en primer lugar deberemos añadir un nuevo tipo MIME al environment.rb de nuestro proyecto:</p>
<div class='highlight'><pre><code class='ruby'><span class='ss'>Mime</span><span class='p'>:</span><span class='ss'>:Type</span><span class='o'>.</span><span class='n'>register</span> <span class='s2'>&quot;text/\*&quot;</span><span class='p'>,</span> <span class='ss'>:all_text</span>
</code></pre></div>
<p>Luego, en la acción en la que estemos guardando la imagen, tenemos que añadir un nuevo manejador de este tipo de peticiones:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>respond_to</span> <span class='k'>do</span> <span class='o'>|</span><span class='nb'>format</span><span class='o'>|</span>
	<span class='nb'>format</span><span class='o'>.</span><span class='n'>all_text</span><span class='p'>{</span> <span class='n'>render</span> <span class='ss'>:text</span> <span class='o'>=&gt;</span> <span class='n'>text_to_render</span> <span class='p'>}</span>
<span class='k'>end</span>
</code></pre></div>
<p>Y eso es todo, con esto Internet Explorer 8 debería estar recibiendo el resultado de la subida de una imagen con SWFUpload.</p>

  <div class="date">
    <hr />
    <span>Oct 06, 2009</span>
    <hr />
  </div>

  <div id="comments">

    <!-- START: Livefyre Embed -->
    <div id="livefyre-comments"></div>
    <script type="text/javascript" src="http://zor.livefyre.com/wjs/v3.0/javascripts/livefyre.js"></script>
    <script type="text/javascript">
    (function () {
        var articleId = fyre.conv.load.makeArticleId(null);
        fyre.conv.load({}, [{
            el: 'livefyre-comments',
            network: "livefyre.com",
            siteId: "323683",
            articleId: articleId,
            signed: false,
            collectionMeta: {
                articleId: articleId,
                url: fyre.conv.load.makeCollectionUrl(),
            }
        }], function() {});
    }());
    </script>
    <!-- END: Livefyre Embed -->

  </div>
</article>


  <footer>
    Check the <a href="http://github.com/ferdev/ferdev">source code of this site on Github</a>.

  </footer>
  <script type="text/javascript" src="/javascripts/modernizer.js"></script>
<script type="text/javascript" src="/javascripts/ferdev.js"></script>
<script type="text/javascript" src="//use.typekit.net/jud5abl.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
	try {
		var pageTracker = _gat._getTracker("UA-6392398-3");
		pageTracker._trackPageview();
	} catch(err) {}
</script>

</body>
</html>
